---
import Envelope from '@/assets/social-icons/envelope.svg'
import GitHub from '@/assets/social-icons/github.svg'
import GitLab from '@/assets/social-icons/gitlab.svg'
import LinkedIn from '@/assets/social-icons/linkedin-in.svg'
import Scholar from '@/assets/social-icons/google-scholar.svg'
import X from '@/assets/social-icons/x-twitter.svg'
import Inspire from '@/assets/social-icons/inspire.svg'
import Arxiv from '@/assets/social-icons/arxiv.svg'
import Orcid from '@/assets/social-icons/orcid.svg'

import { social } from '@/settings'

const activeSocial = Object.keys(social).filter((key) => social[key as keyof typeof social] !== '')
const calculatedIconSize = activeSocial.length <= 5 ? 'size-6' : activeSocial.length <= 6 ? 'size-5' : 'size-4'
const calculatedContainerSize = activeSocial.length <= 5 ? 'size-12' : activeSocial.length <= 6 ? 'size-10' : 'size-8'

---

<div class='flex flex-wrap justify-between items-center relative text-[#115e59]'>

	<!-- Email -->
	{social.email !== '' &&
		<div class="relative">
			<button 
				id="copy-email-icon-btn"
				class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300 cursor-pointer`}
				title="Click to copy email"
			>
				<Envelope class={calculatedIconSize} fill="currentColor" />
			</button>
			<span 
				id="email-copied-tooltip" 
				class="hidden absolute -top-8 left-1/2 transform -translate-x-1/2 bg-success text-success-content text-xs px-2 py-1 rounded whitespace-nowrap"
			>
				Copied!
			</span>
		</div>
	}

	<!-- GitHub -->
	{social.github !== '' &&
		<a href={social.github} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<GitHub class={calculatedIconSize} fill="currentColor" />
		</a>
	}

	<!-- GitLab -->
	{social.gitlab !== '' &&
		<a href={social.gitlab} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<GitLab class={calculatedIconSize} fill="currentColor" />
	</a>
	}

	<!-- X -->
	{social.x !== '' &&
		<a href={social.x} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<X class={calculatedIconSize} fill="currentColor" />
		</a>
	}

	<!-- Linkedin -->
	{social.linkedin !== '' &&
		<a href={social.linkedin} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<LinkedIn class={calculatedIconSize} fill="currentColor" />
		</a>
	}

	<!-- Google Scholar -->
	{social.scholar !== '' &&
		<a 
			href={social.scholar} 
			target="_blank" 
			class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}
			title="Google Scholar Profile"
			aria-label="Google Scholar"
		>
			<Scholar class={calculatedIconSize} fill="currentColor" />
		</a>
	}

<!-- Inspire -->
	{social.inspire !== '' &&
		<a href={social.inspire} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<Inspire class={calculatedIconSize} fill="currentColor" />
		</a>
	}

<!-- arxiv -->
	{social.arxiv !== '' &&
		<a href={social.arxiv} target="_blank" class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}>
			<Arxiv class={calculatedIconSize} fill="currentColor" />
		</a>
	  }
    <!-- orcid -->
	  {social.orcid !== '' &&
		<a 
			href={social.orcid} 
			target="_blank" 
			class={`${calculatedContainerSize} inline-flex items-center justify-center rounded-xl hover:bg-primary/20 transition-all duration-300`}
			title="ORCID Profile"
			aria-label="ORCID"
		>
			<Orcid class={calculatedIconSize} fill="currentColor" />
		</a>
	}
</div>

<script is:inline>
	// Function to setup email icon copy functionality
	function setupEmailIconCopy() {
		const copyEmailIconBtn = document.getElementById('copy-email-icon-btn');
		const emailCopiedTooltip = document.getElementById('email-copied-tooltip');
		
		if (copyEmailIconBtn && emailCopiedTooltip && !copyEmailIconBtn.dataset.listenerAttached) {
			copyEmailIconBtn.dataset.listenerAttached = 'true';
			copyEmailIconBtn.addEventListener('click', async () => {
				const email = 'zl788@cornell.edu';
				try {
					await navigator.clipboard.writeText(email);
					
					// Show "Copied!" tooltip
					emailCopiedTooltip.classList.remove('hidden');
					copyEmailIconBtn.classList.add('bg-success/30');
					
					// Hide after 1.5 seconds
					setTimeout(() => {
						emailCopiedTooltip.classList.add('hidden');
						copyEmailIconBtn.classList.remove('bg-success/30');
					}, 1500);
				} catch (err) {
					console.error('Failed to copy email:', err);
					alert('Failed to copy email. Please copy manually: zl788@cornell.edu');
				}
			});
		}
	}
	
	// Setup on initial load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', setupEmailIconCopy);
	} else {
		setupEmailIconCopy();
	}
	
	// Re-setup after page navigation (if using view transitions)
	document.addEventListener('astro:page-load', setupEmailIconCopy);
</script>
