---
import { ClientRouter } from 'astro:transitions';

import BetterIcon from '../components/ui/BetterIcon.astro'
import DarkLightController from '../components/ui/DarkLightController.astro'
import ThemeSelector from '../components/ui/ThemeSelector.astro'
import Navbar from '../components/ui/Navbar.astro'
import Head from '../components/Head.astro'
import FloatingContactButton from '../components/ui/FloatingContactButton.astro'

import { seo, profile, template } from '../settings'
import Footer from '../components/ui/Footer.astro'

type Props = {
	title?: string
	description?: string
	image?: string
}

const {
	title = seo.default_title,
	description = seo.default_description,
	image = seo.default_image,
} = Astro.props
---

<!doctype html>
<html lang='en'>
	<head>
		{template.transitions && <ClientRouter /> }

		<Head title={title} description={description} image={image} />
		
		<!-- Google Fonts: Professional Typography System -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<!-- Primary: Inter for all text -->
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
		<!-- Technical/Code: Roboto Mono for engineering elements -->
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;600&display=swap" rel="stylesheet">

		<style is:global>
			/* Midnight / Heavy R&D Color Scheme - High Contrast */
			:root {
				--color-bg: #ffffff;
				--color-text-main: #0f172a;
				--color-primary: #115e59;
				--color-secondary: #042f2e;
				--color-border: #e2e8f0;
			}
			
			/* Apply Roboto Mono to technical labels and 'Seeking R&D' status */
			em {
				font-family: 'Roboto Mono', monospace !important;
				font-style: normal !important;
				color: #115e59 !important;
				background-color: transparent !important;
				padding: 0.125rem 0.5rem !important;
				border: 1px solid #115e59 !important;
				border-radius: 0.25rem !important;
				font-weight: 600 !important;
			}
			
			code, kbd, samp, pre {
				font-family: 'Roboto Mono', monospace !important;
				background-color: #ffffff !important;
				border: 1px solid #cbd5e1 !important;
				color: #334155 !important;
			}
			
			/* Increase line-height for all paragraph text */
			p {
				line-height: 1.7 !important;
				color: #0f172a !important;
			}
			
			/* Headings - Midnight Teal (almost black with green hint) */
			h1, h2, h3, h4 {
				color: #042f2e !important;
			}
			
			/* Links - Deep Pine Teal with underline */
			a:not(.btn) {
				color: #115e59 !important;
				text-decoration: underline !important;
			}
			a:not(.btn):hover {
				color: #042f2e !important;
			}
			
			/* Primary Buttons - Deep Pine Teal, no shadow */
			.btn-primary {
				background-color: #115e59 !important;
				border-color: #115e59 !important;
				color: #ffffff !important;
				box-shadow: none !important;
			}
			.btn-primary:hover, .btn-primary:active, .btn-primary:focus, .btn-primary:focus-visible {
				background-color: #042f2e !important;
				border-color: #042f2e !important;
				outline: none !important;
			}
			
			/* Accent Buttons - Same as Primary */
			.btn-accent {
				background-color: #115e59 !important;
				border-color: #115e59 !important;
				color: #ffffff !important;
				box-shadow: none !important;
			}
			.btn-accent:hover, .btn-accent:active, .btn-accent:focus, .btn-accent:focus-visible {
				background-color: #042f2e !important;
				border-color: #042f2e !important;
				outline: none !important;
			}
			
			/* Outline/Secondary Buttons - Transparent with border */
			.btn-outline {
				background-color: transparent !important;
				border-color: #115e59 !important;
				color: #115e59 !important;
				box-shadow: none !important;
			}
			.btn-outline:hover, .btn-outline:active, .btn-outline:focus, .btn-outline:focus-visible {
				background-color: #115e59 !important; /* Dark Green */
				border-color: #115e59 !important;
				color: #ffffff !important;
				outline: none !important;
			}

			/* Secondary Buttons - Ensure they are also green/teal family */
			.btn-secondary {
				background-color: #042f2e !important;
				border-color: #042f2e !important;
				color: #ffffff !important;
			}
			.btn-secondary:hover, .btn-secondary:active, .btn-secondary:focus, .btn-secondary:focus-visible {
				background-color: #115e59 !important;
				border-color: #115e59 !important;
				color: #ffffff !important;
				outline: none !important;
			}

			/* Ghost Buttons - Light teal hover */
			.btn-ghost:hover, .btn-ghost:active, .btn-ghost:focus, .btn-ghost:focus-visible {
				background-color: #ccfbf1 !important; /* Teal-100 */
				color: #115e59 !important;
			}
			
			/* Accent text for checkmarks and highlights - Deep Pine Teal */
			.text-accent {
				color: #115e59 !important;
			}
			
			/* Border accents */
			.border-accent {
				border-color: #115e59 !important;
			}
			
			/* Remove light teal backgrounds - force white */
			.bg-accent\/5 {
				background-color: #ffffff !important;
				border: 1px solid #e2e8f0 !important;
			}
			
			/* Cards - Pure white with clean border */
			.card.bg-base-200, .card {
				background-color: #ffffff !important;
				border: 1px solid #e2e8f0 !important;
			}
			
			/* Dividers - Clean light grey */
			.border-base-300 {
				border-color: #e2e8f0 !important;
			}
			
			/* Navigation link styles */
			.nav-link-biotech {
				color: #0f172a !important;
			}
			.nav-link-biotech:hover, .nav-link-biotech.active {
				color: #115e59 !important;
			}
			
			/* Strong text - Midnight Teal */
			strong {
				color: #042f2e !important;
			}
			
			/* Body and section backgrounds - Pure White */
			body, section, .container {
				background-color: #ffffff !important;
			}
			
			/* Text primary color override */
			.text-primary {
				color: #115e59 !important;
			}
			
			/* Base-200 backgrounds - Force white */
			.bg-base-200 {
				background-color: #ffffff !important;
			}

			/* GLOBAL FOCUS RING OVERRIDE - Remove all blue rings */
			:focus-visible {
				outline: 2px solid #115e59 !important;
				outline-offset: 2px !important;
			}
			
			/* Button Focus - Ensure green ring */
			.btn:focus, .btn:focus-visible {
				outline: none !important;
				box-shadow: 0 0 0 2px #ffffff, 0 0 0 4px #115e59 !important;
				border-color: #115e59 !important;
			}
			
			/* Fix for specific button states that might still show blue */
			.btn-active, .btn.btn-active {
				background-color: #115e59 !important;
				border-color: #115e59 !important;
				color: #ffffff !important;
			}
		</style>

	</head>
	<body>
		<div class={`bg-base-100 drawer lg:drawer-open ${template.menu_left ? 'drawer-end' : ''}`}>
			<input id='my-drawer' type='checkbox' class='drawer-toggle' />
			<!-- Drawer content -->
            <div class='drawer-content bg-base-100'>
				<div class={`sticky top-0 bg-base-100/80 backdrop-blur-md z-50 text-base-content shadow-sm w-full ${Astro.slots.has('top-nav') ? '' : 'lg:hidden'}`}>
					<nav class='navbar w-full min-h-0 h-10 px-2'>
						<div class='navbar-start'>
							<label for='my-drawer' class='btn btn-square btn-ghost lg:hidden btn-sm' aria-label='Open navigation menu'>
								<svg
									xmlns='http://www.w3.org/2000/svg'
									fill='none'
									viewBox='0 0 24 24'
									stroke-width='1.5'
									class='size-5 stroke-current'
								>
									<path
										stroke-linecap='round'
										stroke-linejoin='round'
										d='M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5'></path>
								</svg>
							</label>
						</div>
						<div class='navbar-center text-base font-semibold'>
							<span class="lg:hidden">{profile.fullName}</span>
							<div class="hidden lg:flex items-center gap-1">
								<slot name="top-nav" />
							</div>
						</div>
						<div class='navbar-end mr-2'>
						</div>
					</nav>
				</div>
                <main class='p-4 sm:p-8 pt-10 lg:pt-16 w-full lg:max-w-5xl mx-auto min-h-screen flex flex-col justify-between'>
					<!-- Page content -->
					<slot />
				<Footer />
				</main>
			</div>
			<!-- Drawer side -->
			<div class='drawer-side z-40'>
				<label for='my-drawer' aria-label='close sidebar' class='drawer-overlay'
				></label>
				<Navbar />
			</div>
		</div>
		
		<!-- Floating Contact Button - appears on all pages -->
		<FloatingContactButton />
	</body>
</html>

<style is:global>
	/* ========================================
	   MIDNIGHT / HEAVY R&D COLOR SCHEME
	   High Contrast Dark Teal Palette
	   ======================================== */
	:root {
		--color-bg: #ffffff;
		--color-text-main: #0f172a;
		--color-primary: #115e59;
		--color-secondary: #042f2e;
		--color-border: #e2e8f0;
	}
	
	/* ========================================
	   PROFESSIONAL TYPOGRAPHY SYSTEM
	   ======================================== */
	
	/* Base: Humanist sans-serif for body text (warmth + readability) */
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
		background-color: #ffffff !important;
		font-family: 'Source Sans 3', 'Open Sans', system-ui, -apple-system, 'Segoe UI', sans-serif;
		font-weight: 400;
		line-height: 1.75; /* Enhanced readability */
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
	}

	/* Headings: Geometric sans-serif (precision + intelligence) */
	h1, h2, h3, h4, h5, h6,
	.card-title,
	.navbar,
	.btn,
	.badge,
	.stat-title,
	.stat-value {
		font-family: 'Inter', 'IBM Plex Sans', system-ui, sans-serif;
		letter-spacing: -0.025em;
	}

	/* Heading weight hierarchy */
	h1 {
		font-weight: 700;
		letter-spacing: -0.035em;
	}
	
	h2 {
		font-weight: 600;
		letter-spacing: -0.03em;
	}
	
	h3, h4 {
		font-weight: 600;
		letter-spacing: -0.025em;
	}

	/* Body text optimization */
	p, li, td, .prose {
		font-family: 'Source Sans 3', 'Open Sans', system-ui, sans-serif;
		font-weight: 400;
		line-height: 1.75;
	}

	/* Quotes and callouts: Serif for scholarly depth */
	blockquote,
	.prose blockquote,
	q {
		font-family: 'Merriweather', 'Lora', Georgia, serif;
		font-style: italic;
		font-weight: 400;
		line-height: 1.65;
	}

	/* Dark mode typography adjustments */
	[data-theme="professional-dark"] body,
	[data-theme="professional-dark"] p,
	[data-theme="professional-dark"] li,
	[data-theme="professional-dark"] td {
		font-weight: 500; /* Increased weight for legibility */
		line-height: 1.8; /* 5-10% more spacing */
	}

	[data-theme="professional-dark"] h1,
	[data-theme="professional-dark"] h2,
	[data-theme="professional-dark"] h3 {
		font-weight: 700; /* Slightly heavier in dark mode */
	}

	/* ========================================
	   INTERACTION & ACCESSIBILITY
	   ======================================== */

	/* Link states */
	a:not(.btn):not(.link-hover) {
		transition: color 0.2s ease-in-out, text-decoration-color 0.2s ease-in-out;
	}
	
	a:not(.btn):hover {
		text-decoration-thickness: 2px;
	}

	/* Button states */
	.btn {
		transition: all 0.2s ease-in-out;
		font-weight: 500;
		font-family: 'Inter', system-ui, sans-serif;
		border-radius: 0.75rem; /* Soft, modern academic style */
	}
	
	.btn-primary {
		background-color: #115e59 !important;
		border-color: #115e59 !important;
		color: white !important;
		box-shadow: none !important;
	}
	
	.btn-primary:hover {
		background-color: #042f2e !important;
		border-color: #042f2e !important;
		transform: translateY(-1px);
		box-shadow: none !important;
	}
	
	/* Enhanced "View Research" button styling */
	.btn-accent {
		background-color: #115e59 !important;
		border-color: #115e59 !important;
		color: white !important;
		font-weight: 600;
		box-shadow: none !important;
	}
	
	.btn-accent:hover {
		background-color: #042f2e !important;
		border-color: #042f2e !important;
		transform: translateY(-2px);
		box-shadow: none !important;
	}
	
	.btn-accent:active {
		transform: translateY(0);
		box-shadow: none !important;
	}
	
	/* Outline buttons */
	.btn-outline.btn-primary {
		background-color: transparent !important;
		border-color: #115e59 !important;
		color: #115e59 !important;
	}
	
	.btn-outline.btn-primary:hover {
		background-color: #f8fafc !important;
		border-color: #115e59 !important;
		color: #115e59 !important;
		transform: translateY(-1px);
	}
	
	/* Ensure high contrast for accessibility */
	.btn-accent:focus-visible {
		outline: 3px solid #115e59;
		outline-offset: 2px;
	}

	/* Card effects */
	.card {
		transition: box-shadow 0.3s ease-in-out, transform 0.3s ease-in-out;
		background-color: #ffffff !important;
		border: 1px solid #e2e8f0 !important;
	}

	.card:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
	}

	/* Focus states for accessibility */
	*:focus-visible {
		outline: 2px solid #115e59;
		outline-offset: 2px;
	}
	
	/* ========================================
	   MIDNIGHT / HEAVY R&D ELEMENT STYLES
	   ======================================== */
	
	/* Headings - Midnight Teal (almost black with green hint) */
	h1, h2, h3, h4, h5, h6 {
		color: #042f2e !important;
	}
	
	/* Body text - Slate 900 (almost black) */
	p, li, td {
		color: #0f172a;
	}
	
	/* Links - Deep Pine Teal with underline */
	a:not(.btn):not(.nav-link-biotech) {
		color: #115e59 !important;
		text-decoration: underline;
	}
	
	a:not(.btn):not(.nav-link-biotech):hover {
		color: #042f2e !important;
	}
	
	/* Navigation Links */
	.nav-link-biotech {
		color: #0f172a !important;
		text-decoration: none !important;
	}
	
	.nav-link-biotech:hover,
	.nav-link-biotech.active {
		color: #115e59 !important;
	}
	
	/* Accent colors - Deep Pine Teal */
	.text-accent {
		color: #115e59 !important;
	}
	
	.text-primary {
		color: #115e59 !important;
	}
	
	.text-secondary {
		color: #042f2e !important;
	}
	
	/* Border colors - Clean light grey */
	.border-accent {
		border-color: #115e59 !important;
	}
	
	.border-base-300 {
		border-color: #e2e8f0 !important;
	}
	
	/* Background colors - Force white, remove light teal */
	.bg-accent\/5 {
		background-color: #ffffff !important;
		border: 1px solid #e2e8f0 !important;
	}
	
	.bg-base-200 {
		background-color: #ffffff !important;
	}
	
	/* Cards - Pure white with clean border */
	.card {
		background-color: #ffffff !important;
		border: 1px solid #e2e8f0 !important;
	}
	
	/* Tech Stack Tags - White bg with clean border */
	code, kbd, samp, pre {
		font-family: 'Roboto Mono', monospace;
		background-color: #ffffff;
		color: #334155;
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		border: 1px solid #cbd5e1;
	}
	
	/* Badge styling - Transparent with border */
	.badge {
		background-color: transparent !important;
		color: #115e59 !important;
		border: 1px solid #115e59 !important;
		font-weight: 600;
	}
	
	/* Mobile menu button */
	.drawer-toggle ~ .drawer-content .btn-ghost {
		color: #115e59;
	}

	/* ========================================
	   PROSE TYPOGRAPHY (Tailwind Typography)
	   ======================================== */

	.prose {
		max-width: 75ch;
		line-height: 1.75;
		font-family: 'Source Sans 3', 'Open Sans', system-ui, sans-serif;
	}
	
	.prose h1, .prose h2, .prose h3, .prose h4 {
		font-family: 'Inter', 'IBM Plex Sans', system-ui, sans-serif;
		font-weight: 600;
		letter-spacing: -0.025em;
	}
	
	.prose h1 {
		font-weight: 700;
	}
	
	.prose p {
		margin-bottom: 1.25em;
		line-height: 1.75;
	}

	.prose blockquote {
		font-family: 'Merriweather', 'Lora', Georgia, serif;
		font-style: italic;
		border-left-width: 4px;
		padding-left: 1.5em;
	}

	.prose code {
		font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Courier New', monospace;
		font-size: 0.9em;
	}

	/* Dark mode prose adjustments */
	[data-theme="professional-dark"] .prose {
		line-height: 1.8;
	}

	[data-theme="professional-dark"] .prose p,
	[data-theme="professional-dark"] .prose li {
		font-weight: 500;
	}

	/* ========================================
	   UTILITY & LAYOUT
	   ======================================== */

	/* Smooth scrolling */
	html {
		scroll-behavior: smooth;
	}

	/* Section spacing */
	section {
		scroll-margin-top: 2rem;
	}

	/* Badge styling */
	.badge {
		font-weight: 500;
		letter-spacing: 0.025em;
		font-family: 'Inter', system-ui, sans-serif;
	}

	/* Stats styling */
	.stats {
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
	}
	
	.stat-value {
		font-weight: 700;
		font-family: 'Inter', system-ui, sans-serif;
	}
	
	.stat-title {
		font-weight: 500;
		opacity: 0.7;
		font-family: 'Inter', system-ui, sans-serif;
	}

	/* ========================================
	   READING FLUENCY OPTIMIZATION
	   ======================================== */

	/* Optimal line length for reading */
	.max-w-prose {
		max-width: 65ch;
	}

	/* Prevent orphans in headings */
	h1, h2, h3, h4, h5, h6 {
		text-wrap: balance;
	}

	/* Prevent widows in body text */
	p {
		text-wrap: pretty;
	}

	/* ========================================
	   SIDEBAR LAYOUT FIX
	   ======================================== */
	
	/* CRITICAL: Override DaisyUI drawer behavior completely on mobile */
	/* The sidebar must be an OVERLAY, not part of the layout flow */
	
	/* Ensure sticky positioning works in main content */
	main {
		position: relative;
		/* Do NOT add overflow hidden - it breaks sticky */
	}
	
	/* On mobile (< lg), drawer-side must be completely out of layout flow */
	@media (max-width: 1023px) {
		/* Remove drawer-side from layout flow completely */
		.drawer-side {
			position: fixed !important;
			left: -100% !important;
			top: 0 !important;
			width: 80% !important;
			max-width: 320px !important;
			height: 100vh !important;
			z-index: 50 !important;
			transition: left 0.3s ease-in-out;
		}
		
		/* When drawer is opened, slide it in as overlay */
		.drawer-toggle:checked ~ .drawer-side {
			left: 0 !important;
		}
		
		/* Force drawer-content to take FULL width - no sidebar space */
		.drawer:not(.drawer-end) > .drawer-content {
			margin-left: 0 !important;
			width: 100% !important;
		}
		
		/* Ensure main content is never shifted */
		.drawer-content {
			width: 100% !important;
			margin: 0 !important;
		}
	}
	
	/* On desktop (>= lg), drawer-side is part of layout */
	@media (min-width: 1024px) {
		.drawer-side {
			position: sticky;
			top: 0;
			height: 100vh;
			overflow-y: auto;
		}
	}
	
	/* Hide scrollbar */
	.drawer-side {
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none;  /* IE and Edge */
	}
	
	.drawer-side::-webkit-scrollbar {
		display: none; /* Chrome, Safari, Opera */
	}
	
	/* Hide scrollbar in the sidebar content */
	.drawer-side aside {
		overflow-y: auto;
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none;  /* IE and Edge */
	}
	
	.drawer-side aside::-webkit-scrollbar {
		display: none; /* Chrome, Safari, Opera */
	}

	/* --- Global Animations --- */
	
	/* Fade Up */
	.fade-in-up {
		opacity: 0;
		transform: translateY(20px);
		transition: opacity 0.6s ease-out, transform 0.6s ease-out;
		will-change: opacity, transform;
	}
	.fade-in-up.is-visible {
		opacity: 1;
		transform: translateY(0);
	}

	/* Staggered Items (Cards, List Items) */
	.stagger-card, .stagger-item {
		opacity: 0;
		transform: translateY(20px);
		transition: opacity 0.5s ease-out, transform 0.5s ease-out;
		will-change: opacity, transform;
	}
	.stagger-card.is-visible, .stagger-item.is-visible {
		opacity: 1;
		transform: translateY(0);
	}

	/* Accessibility: Respect reduced motion preferences */
	@media (prefers-reduced-motion: reduce) {
		html {
			scroll-behavior: auto;
		}
		.fade-in-up,
		.stagger-card,
		.stagger-item {
			opacity: 1;
			transform: none;
			transition: none;
			will-change: auto;
		}
		.card {
			transition: none;
		}
		.card:hover {
			transform: none;
		}
		.btn {
			transition: none;
		}
		.btn-primary:hover,
		.btn-accent:hover {
			transform: none;
		}
	}
</style>

<script>
	// Global Intersection Observer for scroll animations
	const setupAnimations = () => {
		const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
		const animatedElements = document.querySelectorAll('.fade-in-up, .stagger-card, .stagger-item');

		// If user prefers reduced motion, make everything visible immediately
		if (prefersReducedMotion) {
			animatedElements.forEach(el => el.classList.add('is-visible'));
			return;
		}

		const observerOptions = {
			root: null,
			rootMargin: '0px',
			threshold: 0.1
		};

		const observer = new IntersectionObserver((entries) => {
			let staggerDelay = 0;

			entries.forEach(entry => {
				const target = entry.target;
				if (entry.isIntersecting) {
					if (target.classList.contains('stagger-card') || target.classList.contains('stagger-item')) {
						setTimeout(() => {
							target.classList.add('is-visible');
						}, staggerDelay * 75);
						staggerDelay++;
					} else {
						target.classList.add('is-visible');
					}
				} else {
					target.classList.remove('is-visible');
				}
			});
		}, observerOptions);

		animatedElements.forEach(el => observer.observe(el));
	};

	// Run on initial load
	setupAnimations();

	// Run on view transitions (Astro)
	document.addEventListener('astro:page-load', setupAnimations);
</script>
