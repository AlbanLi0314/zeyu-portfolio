---
import Layout from '../layouts/Layout.astro'
import { getCollection } from 'astro:content'

const papers = await getCollection('papers')
const patents = await getCollection('patents')

// Sort by year descending
const sortedPapers = papers.sort((a, b) => b.data.year - a.data.year)
const sortedPatents = patents.sort((a, b) => (b.data.year || 0) - (a.data.year || 0))
---

<Layout title="Publications - Zeyu Li">
	<div class='max-w-4xl mx-auto'>
		<h1 class='text-4xl font-bold mb-8'>Publications</h1>
		
		<!-- Tabs Navigation -->
		<div class='tabs tabs-boxed mb-8' role="tablist">
			<a href="#papers" class='tab tab-active' role="tab" data-tab="papers">
				Papers ({sortedPapers.length})
			</a>
			<a href="#patents" class='tab' role="tab" data-tab="patents">
				Patents ({sortedPatents.length})
			</a>
		</div>

		<!-- Papers Section -->
		<section id="papers" class="tab-content" style="display: none;">
			<h2 class='text-3xl font-bold mb-6'>Research Papers</h2>
			{sortedPapers.length === 0 ? (
				<p class='text-base-content/60'>No papers yet. Add papers in <code>src/content/papers/</code></p>
			) : (
				<ul class='space-y-6'>
					{sortedPapers.map((paper) => (
						<li class='border-b pb-6 last:border-b-0'>
							<h3 class='text-xl font-semibold mb-2'>
								{paper.data.link ? (
									<a href={paper.data.link} class='link link-primary' target="_blank" rel="noopener noreferrer">
										{paper.data.title}
									</a>
								) : (
									paper.data.title
								)}
							</h3>
							<p class='text-sm text-base-content/70 mb-2'>
								{paper.data.authors.join(', ')}
							</p>
							{paper.data.venue && (
								<p class='text-sm italic mb-2'>{paper.data.venue}</p>
							)}
							<div class='flex gap-4 items-center text-sm'>
								<span class='badge badge-outline'>{paper.data.year}</span>
								{paper.data.doi && (
									<a href={`https://doi.org/${paper.data.doi}`} class='link link-secondary' target="_blank" rel="noopener noreferrer">
										DOI
									</a>
								)}
								{paper.data.pdf && (
									<a href={paper.data.pdf} class='link link-secondary' target="_blank" rel="noopener noreferrer">
										PDF
									</a>
								)}
								{paper.data.featured && (
									<span class='badge badge-primary'>Featured</span>
								)}
							</div>
							{paper.data.keywords && paper.data.keywords.length > 0 && (
								<div class='flex gap-2 mt-3 flex-wrap'>
									{paper.data.keywords.map(keyword => (
										<span class='badge badge-sm'>{keyword}</span>
									))}
								</div>
							)}
						</li>
					))}
				</ul>
			)}
		</section>

		<!-- Patents Section -->
		<section id="patents" class="tab-content" style="display: none;">
			<h2 class='text-3xl font-bold mb-6'>Patents</h2>
			{sortedPatents.length === 0 ? (
				<p class='text-base-content/60'>No patents yet. Add patents in <code>src/content/patents/</code></p>
			) : (
				<ul class='space-y-6'>
					{sortedPatents.map((patent) => (
						<li class='border-b pb-6 last:border-b-0'>
							<h3 class='text-xl font-semibold mb-2'>
								{patent.data.link ? (
									<a href={patent.data.link} class='link link-primary' target="_blank" rel="noopener noreferrer">
										{patent.data.title}
									</a>
								) : (
									patent.data.title
								)}
							</h3>
							<p class='text-sm text-base-content/70 mb-2'>
								{patent.data.inventors.join(', ')}
							</p>
							{patent.data.summary && (
								<p class='text-sm mb-2'>{patent.data.summary}</p>
							)}
							<div class='flex gap-4 items-center text-sm'>
								{patent.data.number && (
									<span class='font-mono text-xs'>{patent.data.number}</span>
								)}
								{patent.data.year && (
									<span class='badge badge-outline'>{patent.data.year}</span>
								)}
								{patent.data.status && (
									<span class={`badge ${patent.data.status === 'granted' ? 'badge-success' : 'badge-warning'}`}>
										{patent.data.status}
									</span>
								)}
							</div>
						</li>
					))}
				</ul>
			)}
		</section>
	</div>
</Layout>

<script>
	// Wait for DOM to be fully loaded
	const tabs = document.querySelectorAll('.tab[data-tab]');
	const paperSection = document.getElementById('papers');
	const patentSection = document.getElementById('patents');
	
	function showTab(tabName: string) {
		// Hide both sections
		if (paperSection) paperSection.style.display = 'none';
		if (patentSection) patentSection.style.display = 'none';
		
		// Show the selected section
		if (tabName === 'papers' && paperSection) {
			paperSection.style.display = 'block';
		} else if (tabName === 'patents' && patentSection) {
			patentSection.style.display = 'block';
		}
		
		// Update tab styling
		tabs.forEach(tab => {
			const tabData = tab.getAttribute('data-tab');
			if (tabData === tabName) {
				tab.classList.add('tab-active');
			} else {
				tab.classList.remove('tab-active');
			}
		});
	}
	
	// Initialize - show papers by default
	showTab('papers');
	
	// Add click handlers
	tabs.forEach(tab => {
		tab.addEventListener('click', (e) => {
			e.preventDefault();
			const tabName = tab.getAttribute('data-tab');
			if (tabName) {
				showTab(tabName);
			}
		});
	});
</script>

<style>
	.tab-content {
		animation: fadeIn 0.3s ease-in;
	}
	
	@keyframes fadeIn {
		from { opacity: 0; }
		to { opacity: 1; }
	}
</style>
