---
import Layout from '../layouts/Layout.astro'

import HeroSection from '@/components/ai/HeroSection.astro'
import ProductsSection from '@/components/ai/ProductsSection.astro'
import ResearchPipeline from '@/components/ai/ResearchPipeline.astro'
import PhilosophySection from '@/components/ai/PhilosophySection.astro'
import TeachingSection from '@/components/ai/TeachingSection.astro'

const navItems = [
  { id: 'research', label: 'Research' },
  { id: 'products', label: 'Products' },
  { id: 'philosophy', label: 'Philosophy' },
  { id: 'teaching', label: 'Teaching' },
]
---

<Layout title="AI Integration - Zeyu Li">
  <Fragment slot="top-nav">
    {navItems.map((item) => (
      <a
        href={`#${item.id}`}
        class="ai-nav-link text-xs font-medium text-base-content/40 hover:text-primary transition-colors cursor-pointer px-2 py-1 rounded"
        data-target={item.id}
      >
        {item.label}
      </a>
    ))}
  </Fragment>

  <div class="max-w-6xl mx-auto">
    <HeroSection />
    <ResearchPipeline />
    <ProductsSection />
    <PhilosophySection />
    <TeachingSection />
  </div>
</Layout>

<script>
  const setupAiNav = () => {
    const sections = document.querySelectorAll<HTMLElement>('section[id]');
    const navLinks = document.querySelectorAll<HTMLElement>('.ai-nav-link');

    if (!navLinks.length) return;

    const observerOptions = {
      root: null,
      rootMargin: '-20% 0px -66% 0px',
      threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');

          navLinks.forEach((link) => {
            link.classList.remove('ai-nav-active');
          });

          const activeLink = document.querySelector(`.ai-nav-link[data-target="${id}"]`);
          if (activeLink) {
            activeLink.classList.add('ai-nav-active');
          }
        }
      });
    }, observerOptions);

    sections.forEach((section) => observer.observe(section));
  };

  setupAiNav();
  document.addEventListener('astro:page-load', setupAiNav);
</script>

<style>
  html {
    scroll-behavior: smooth;
  }

  .ai-nav-link {
    text-decoration: none !important;
    transition: color 0.2s ease;
    position: relative;
    padding-bottom: 0.25rem;
  }

  .ai-nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background-color: #115e59;
    transition: width 0.2s ease, left 0.2s ease;
  }

  .ai-nav-active {
    color: #115e59 !important;
    font-weight: 600;
  }

  .ai-nav-active::after {
    width: 100%;
    left: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
    .ai-nav-link {
      transition: none;
    }
  }
</style>
